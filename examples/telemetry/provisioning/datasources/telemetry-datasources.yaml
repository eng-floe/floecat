# Copyright 2026 Yellowbrick Data, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

apiVersion: 1
datasources:
  - name: prometheus
    type: prometheus
    access: proxy
    url: http://prometheus:9090
    isDefault: true
    editable: true
  - name: tempo
    type: tempo
    uid: tempo
    access: proxy
    url: http://tempo:3100
    editable: true
    jsonData:
      httpMethod: GET
      grpcServer: tempo:9095
      tracesToLogsV2:
        datasourceUid: loki
        tags: []
        filterByTraceID: true
        filterBySpanID: true
        logLineContainsTraceId: '{service_name="floecat-service"} |= "\"traceId\":\"${__trace.traceId}\""'
        logLineContainsSpanId: '{service_name="floecat-service"} |= "\"spanId\":\"${__trace.spanId}\""'
      tracesToMetrics:
        datasourceUid: prometheus
      nodeGraph:
        enabled: true
  - name: loki
    type: loki
    uid: loki
    access: proxy
    url: http://loki:3100
    editable: true
    jsonData:
      derivedFields:
        - datasourceUid: tempo
          matcherRegex: "\"traceId\"\\s*:\\s*\"([a-f0-9]{32})\""
          name: TraceID
          url: "$${__value.raw}"
        - datasourceUid: tempo
          matcherRegex: "\"spanId\"\\s*:\\s*\"([a-f0-9]{16})\""
          name: SpanID
          url: "$${__value.raw}"
